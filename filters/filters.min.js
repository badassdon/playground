/**
 * HTML5 Canvas ImageFilters v0.1.0 - 2012-10-25
 * http://www.hackyon.com/playground/filters 
 * 
 * Copyright (c) 2012 Donald Lau (badassdon); Licensed MIT
 */
(function(e){var t=function(){},n=function(){function e(e,t,n){this._nextNodes||(this._nextNodes=[]),this._nextNodes.push(e),this._x=t||0,this._y=n||0}function t(e){if(!this._nextNodes)return;for(var t=0;t<this._nextNodes.length;t++){var n=this._nextNodes[t];n.render(e,this)}}function n(e){return Math.max(Math.min(e,255),0)}return function(){return this.connect=e,this.render=t,this._next=t,this.clamp=n,this}}(),r=function(){};n.call(r.prototype),r.prototype.render=function(){var e=this,t=new Image;t.onload=function(){var n=document.createElement("canvas");n.setAttribute("width",t.width),n.setAttribute("height",t.height);var r=n.getContext("2d");r.drawImage(t,0,0);var i=r.getImageData(0,0,t.width,t.height);e._next(i)},t.src=e.url},t.prototype.createSource=function(){return new r};var i=function(){this.width=0,this.height=0,this.canvas=null};n.call(i.prototype),i.prototype.render=function(e,t){var n=this.canvas;n?(this.width=n.width,this.height=n.height):(n=document.createElement("canvas"),n.setAttribute("width",this.width),n.setAttribute("height",this.height),this.canvas=n);var r=t._x||0,i=t._y||0,s=n.getContext("2d");s.putImageData(e,r,i);var o=s.getImageData(0,0,this.width,this.height);this._next(o)},t.prototype.createLayer=function(){return new i};var s=function(){this.offsetX=0,this.offsetY=0,this.canvas=null};n.call(s.prototype),s.prototype.render=function(e){if(!this.canvas){this._next(e);return}var t=this.canvas,n=t.getContext("2d"),r=n.getImageData(0,0,t.width,t.height);for(var i=0;i<r.width;i++)for(var s=0;s<r.height;s++){var o=(i+s*r.width)*4,u=this.offsetX+i,a=this.offsetY+s;if(u>=e.width||a>=e.height)continue;var f=(u+a*e.width)*4;e.data[f+3]!==0&&(e.data[f+3]=r.data[o+3])}this._next(e)},t.prototype.createCanvasMask=function(){return new s};var o=function(){this.value=0};n.call(o.prototype),o.AVERAGE=function(e,t,n){return(e+t+n)/3},o.LIGHTNESS=function(e,t,n){return.5*(Math.max(e,t,n)+Math.min(e,t,n))},o.LUMINOSITY=function(e,t,n){return e*.2125+t*.7154+n*.0721},o.prototype.render=function(e){var t=o.AVERAGE;for(var n=0;n<e.data.length;n+=4){var r=e.data[n],i=e.data[n+1],s=e.data[n+2],u=t(r,i,s);e.data[n]=this.clamp(r+(r-u)*this.value),e.data[n+1]=this.clamp(i+(i-u)*this.value),e.data[n+2]=this.clamp(s+(s-u)*this.value)}this._next(e)},t.prototype.createSaturationFilter=function(){return new o};var u=function(){this.value=0};n.call(u.prototype),u.prototype.render=function(e){for(var t=0;t<e.data.length;t+=4){var n=e.data[t],r=e.data[t+1],i=e.data[t+2];e.data[t]=Math.min(n+this.value,255),e.data[t+1]=Math.min(r+this.value,255),e.data[t+2]=Math.min(i+this.value,255)}this._next(e)},t.prototype.createBrightnessFilter=function(){return new u};var a=function(){this.multiplier=1};n.call(a.prototype),a.prototype.render=function(e){for(var t=0;t<e.data.length;t+=4){var n=e.data[t],r=e.data[t+1],i=e.data[t+2];e.data[t]=this.clamp((n-128)*this.multiplier+128),e.data[t+1]=this.clamp((r-128)*this.multiplier+128),e.data[t+2]=this.clamp((i-128)*this.multiplier+128)}this._next(e)},t.prototype.createContrastFilter=function(){return new a};var f=function(){this.depth=8,this.intensity=18};n.call(f.prototype),f.prototype.render=function(e){for(var t=0;t<e.data.length;t+=4){var n=e.data[t],r=e.data[t+1],i=e.data[t+2],s=(n+r+i)/3;n=r=i=s,n=Math.min(n+this.depth*2,255),r=Math.min(r+this.depth,255),i=Math.max(i-this.intensity,0),e.data[t]=n,e.data[t+1]=r,e.data[t+2]=i}this._next(e)},t.prototype.createSepiaFilter=function(){return new f},e.ImageFilterContext=t})(window);