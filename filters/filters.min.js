/**
 * HTML5 Canvas ImageFilters v0.1.0 - 2012-10-25
 * http://www.hackyon.com/playground/filters 
 * 
 * Copyright (c) 2012 Donald Lau (badassdon); Licensed MIT
 */
(function(e){var t=function(){},n=function(){function e(e,t,n){this._nextNodes||(this._nextNodes=[]),this._nextNodes.push(e),this._x=t||0,this._y=n||0}function t(e){if(!this._nextNodes)return;for(var t=0;t<this._nextNodes.length;t++){var n=this._nextNodes[t];n.render(e,this)}}return function(){return this.connect=e,this.render=t,this._next=t,this}}(),r=function(){};r.average=function(e,t,n){return(e+t+n)/3},r.lightness=function(e,t,n){return.5*(Math.max(e,t,n)+Math.min(e,t,n))},r.luminosity=function(e,t,n){return e*.2125+t*.7154+n*.0721};var i=function(){};i.compute=function(e){var t=new Float32Array(256),n=0;for(var i=0;i<e.data.length;i+=4){var s=e.data[i],o=e.data[i+1],u=e.data[i+2],a=Math.round(r.lightness(s,o,u));t[a]+=1,n=Math.max(n,t[a])}for(var f=0;f<t.length;f+=1)t[f]=t[f]/n;return t},i.draw=function(e,t){var n=t.getContext("2d"),r=t.width/256,i=t.height;for(var s=0;s<e.length;s+=1)n.fillRect(s*r,i,r,-i*(1-e[s]))};var s=function(){};s.add=function(e,t){var n=[];for(var r=0;r<e.length;r++){n[r]=[];for(var i=0;i<e[r].length;i++)n[r][i]=e[r][i]+t[r][i]}return n},s.multiply=function(e,t){var n=[];for(var r=0;r<e.length;r++){n[r]=[];for(var i=0;i<t[0].length;i++){n[r][i]=0;for(var s=0;s<e[r].length;s++)n[r][i]+=e[r][s]*t[s][i]}}return n},s.gaussianJordanElimination=function(e){var t=e.length,n=0,r=0,i=0,s=0;for(n=0;n<t;n++)for(r=n+1;r<t;r++){s=e[r][n]/e[n][n];for(i=n;i<e[r].length;i++)e[r][i]=e[r][i]-s*e[n][i]}for(n=0;n<t;n++){s=e[n][n];for(i=n;i<e[n].length;i++)e[n][i]=e[n][i]/s}for(n=t-1;n>=0;n--)for(r=n-1;r>=0;r--){s=e[r][n];for(i=n;i<e[r].length;i++)e[r][i]=e[r][i]-s*e[n][i]}return e},s.augment=function(e,t){var n=[],r=0,i=0;for(r=0;r<e.length;r++){n[r]=[];for(i=0;i<e[r].length;i++)n[r].push(e[r][i]);for(i=0;i<t[r].length;i++)n[r].push(t[r][i])}return n},s.inverse=function(e){var t=e.length,n=0,r=0,i=[];for(n=0;n<t;n++){i[n]=[];for(r=0;r<t;r++)n===r?i[n][r]=1:i[n][r]=0}var o=s.augment(e,i);s.gaussianJordanElimination(o);var u=[];for(n=0;n<t;n++){u[n]=[];for(r=0;r<t;r++)u[n][r]=o[n][t+r]}return u},s.solveLinearEquations=function(e,t){var n=s.augment(e,t);s.gaussianJordanElimination(n);var r=[],i=n[0].length-1;for(var o=0;o<n.length;o++)r[o]=n[o][i];return r};var o=function(){};o.convertRGBtoCMYK=function(e){var t=new ArrayBuffer(e.data.length*4),n=new Float32Array(t);for(var r=0;r<e.data.length;r+=4){var i=e.data[r],s=e.data[r+1],o=e.data[r+2],u=1-i/255,a=1-s/255,f=1-o/255,l=Math.min(u,a,f);n[r]=(u-l)/(1-l)*100,n[r+1]=(a-l)/(1-l)*100,n[r+2]=(f-l)/(1-l)*100,n[r+3]=l*100}return n},o.convertCMYKtoRGB=function(e,t){for(var n=0;n<e.length;n+=4){var r=e[n]/100,i=e[n+1]/100,s=e[n+2]/100,o=e[n+3]/100;t.data[n]=Math.round(255*(1-(r*(1-o)+o))),t.data[n+1]=Math.round(255*(1-(i*(1-o)+o))),t.data[n+2]=Math.round(255*(1-(s*(1-o)+o)))}return t};var u=function(){};u.convertRGBtoYIQ=function(e){var t=new ArrayBuffer(e.data.length*3),n=new Float32Array(t);for(var r=0,i=0;r<e.data.length;r+=4,i+=3){var s=e.data[r],o=e.data[r+1],u=e.data[r+2];n[i]=.299*s+.587*o+.114*u,n[i+1]=.596*s-.274*o-.321*u,n[i+2]=.211*s-.523*o+.311*u}return n},u.convertYIQtoRGB=function(e,t){for(var n=0,r=0;r<e.length;n+=4,r+=3){var i=e[r],s=e[r+1],o=e[r+2];t.data[n]=Math.round(i+.956*s+.621*o),t.data[n+1]=Math.round(i-.272*s-.647*o),t.data[n+2]=Math.round(i-1.107*s+1.705*o)}return t},u.shiftHue=function(e,t){for(var n=0;n<e.length;n+=3){var r=e[n+1],i=e[n+2];e[n+1]=r*Math.cos(t)-i*Math.sin(t),e[n+2]=r*Math.sin(t)+i*Math.cos(t)}},u.shiftSaturation=function(e,t){for(var n=0;n<e.length;n+=3)e[n+1]=e[n+1]*t,e[n+2]=e[n+2]*t},u.shiftValue=function(e,t){for(var n=0;n<e.length;n+=3)e[n]=e[n]*t,e[n+1]=e[n+1]*t,e[n+2]=e[n+2]*t};var a=function(){};a.apply=function(e,t){var n=new Uint8Array(t.data),r=e.length,i=e[0].length;for(var s=0;s<t.width;s++)for(var o=0;o<t.height;o++){var u=(s+o*t.width)*4,a=0,f=0,l=0,c=0;for(var h=0;h<r;h++){var p=o+h-Math.floor(r/2);if(p>=0&&p<t.height)for(var d=0;d<i;d++){var v=s+d-Math.floor(i/2);if(v>=0&&v<t.width){var m=(v+p*t.width)*4;c+=e[h][d],a+=n[m]*e[h][d],f+=n[m+1]*e[h][d],l+=n[m+2]*e[h][d]}}}t.data[u]=Math.round(a/c),t.data[u+1]=Math.round(f/c),t.data[u+2]=Math.round(l/c)}return t};var f=function(){};n.call(f.prototype),f.prototype.render=function(){var e=this,t=new Image;t.onload=function(){var n=document.createElement("canvas");n.setAttribute("width",t.width),n.setAttribute("height",t.height);var r=n.getContext("2d");r.drawImage(t,0,0);var i=r.getImageData(0,0,t.width,t.height);e._next(i)},t.src=e.url},t.prototype.createSource=function(){return new f};var l=function(){this.width=0,this.height=0,this.canvas=null};n.call(l.prototype),l.prototype.render=function(e,t){var n=this.canvas;n?(this.width=n.width,this.height=n.height):(n=document.createElement("canvas"),n.setAttribute("width",this.width),n.setAttribute("height",this.height),this.canvas=n);var r=t._x||0,i=t._y||0,s=n.getContext("2d");s.putImageData(e,r,i);var o=s.getImageData(0,0,this.width,this.height);this._next(o)},t.prototype.createLayer=function(){return new l};var c=function(){this.offsetX=0,this.offsetY=0,this.canvas=null};n.call(c.prototype),c.prototype.render=function(e){if(!this.canvas){this._next(e);return}var t=this.canvas,n=t.getContext("2d"),r=n.getImageData(0,0,t.width,t.height);for(var i=0;i<r.width;i++)for(var s=0;s<r.height;s++){var o=(i+s*r.width)*4,u=this.offsetX+i,a=this.offsetY+s;if(u>=e.width||a>=e.height)continue;var f=(u+a*e.width)*4;e.data[f+3]!==0&&(e.data[f+3]=r.data[o+3])}this._next(e)},t.prototype.createCanvasMask=function(){return new c};var h=function(){this.size=10};n.call(h.prototype),h.prototype.render=function(e){var t=Math.ceil(e.width/this.size),n=Math.ceil(e.height/this.size);for(var r=0;r<t;r++)for(var i=0;i<n;i++){var s=r*this.size,o=i*this.size,u=(s+o*e.width)*4,a=e.data[u],f=e.data[u+1],l=e.data[u+2],c=e.data[u+3];for(var h=0;h<this.size;h++)for(var p=0;p<this.size;p++){var d=(s+h+(o+p)*e.width)*4;e.data[d]=a,e.data[d+1]=f,e.data[d+2]=l,e.data[d+3]=c}}this._next(e)},t.prototype.createPixelateFilter=function(){return new h};var p=function(){this.kernel=[[1,1,1],[1,1,1],[1,1,1]]};n.call(p.prototype),p.prototype.useBasicBlur=function(){this.kernel=[[1,1,1],[1,1,1],[1,1,1]]},p.prototype.useBasicSoften=function(){this.kernel=[[1,1,1],[1,10,1],[1,1,1]]},p.prototype.useBasicSharpen=function(){this.kernel=[[0,-1,0],[-1,6,-1],[0,-1,0]]},p.prototype.useBoxBlur=function(e){this.kernel=[];var t=2*e+1;for(var n=0;n<t;n++){this.kernel[n]=[];for(var r=0;r<t;r++){var i=Math.sqrt(Math.pow(n-e,2)+Math.pow(r-e,2));this.kernel[n][r]=Math.round(i)<e?1:0}}},p.prototype.useGaussianBlur=function(e,t){this.kernel=[];var n=2*e+1;for(var r=0;r<n;r++){this.kernel[r]=[];for(var i=0;i<n;i++)this.kernel[r][i]=1/(2*Math.PI*t*t)*Math.exp(-(Math.pow(r-e,2)+Math.pow(i-e,2))/(2*t*t))}},p.prototype.render=function(e){a.apply(this.kernel,e),this._next(e)},t.prototype.createBlurFilter=function(){return new p};var d=function(){this.value=0,this.compute=r.average};n.call(d.prototype),d.prototype.render=function(e){for(var t=0;t<e.data.length;t+=4){var n=e.data[t],r=e.data[t+1],i=e.data[t+2],s=this.compute(n,r,i);e.data[t]=n+(n-s)*this.value,e.data[t+1]=r+(r-s)*this.value,e.data[t+2]=i+(i-s)*this.value}this._next(e)},t.prototype.createSaturationFilter=function(){return new d};var v=function(){this.precompute=null,this.curve=null};n.call(v.prototype),v.prototype.useLevels=function(e,t,n){this.useCubicSplineCurve([{input:e,output:0},{input:t,output:127},{input:n,output:255}])},v.prototype.useCubicSplineCurve=function(e){e.sort(function(e,t){return e.input-t.input});if(e.length==2){var t=(e[1].output-e[0].output)/(e[1].input-e[0].input);this.curve=function(n){return n<e[0].input?0:n>e[1].input?255:(n-e[0].input)*t+e[0].output}}else{var n=[],r=[],i=0,o=0,u=e.length;for(i=0;i<u;i++){n[i]=[];for(o=0;o<u;o++)n[i][o]=0;r[i]=[],r[i][0]=0}n[0][0]=2/(e[1].input-e[0].input),n[0][1]=1/(e[1].input-e[0].input),r[0][0]=3*(e[1].output-e[0].output)/Math.pow(e[1].input-e[0].input,2),i=u-1,n[i][i]=2/(e[i].input-e[i-1].input),n[i][i-1]=1/(e[i].input-e[i-1].input),r[i][0]=3*(e[i].output-e[i-1].output)/Math.pow(e[i].input-e[i-1].input,2);for(i=1;i<u-1;i++)n[i][i-1]=1/(e[i].input-e[i-1].input),n[i][i]=2*(1/(e[i].input-e[i-1].input)+1/(e[i+1].input-e[i].input)),n[i][i+1]=1/(e[i+1].input-e[i].input),r[i][0]=3*((e[i].output-e[i-1].output)/Math.pow(e[i].input-e[i-1].input,2)+(e[i+1].output-e[i].output)/Math.pow(e[i+1].input-e[i].input,2));var a=s.solveLinearEquations(n,r),f=[];e[0].input>0&&f.push({start:0,end:e[0].input,f:function(e){return 0}});var l=function(t,n,r){return function(i){var s=(i-e[r].input)/(e[r+1].input-e[r].input);return(1-s)*e[r].output+s*e[r+1].output+s*(1-s)*(t*(1-s)+n*s)}};for(i=0;i<u-1;i++){var c=a[i]*(e[i+1].input-e[i].input)-(e[i+1].output-e[i].output),h=-a[i+1]*(e[i+1].input-e[i].input)+(e[i+1].output-e[i].output);f.push({start:e[i].input,end:e[i+1].input,f:l(c,h,i)})}e[u-1].input<255&&f.push({start:e[u-1].input,end:255,f:function(e){return 255}});var p=[];this.curve=function(e){if(p[e]!==undefined)return p[e];var t=0,n=f.length-1,r=null;while(t<n){var i=Math.floor((n+t)/2);if(f[i].start>e)n=i-1;else{if(!(f[i].end<e)){r=f[i].f;break}t=i+1}}return r||(r=f[t].f),p[e]=r(e),p[e]}}},v.prototype.render=function(e){var t=null;this.precompute&&(t=this.precompute(e));for(var n=0;n<e.data.length;n+=4){var r=e.data[n],i=e.data[n+1],s=e.data[n+2];e.data[n]=this.curve(r,t),e.data[n+1]=this.curve(i,t),e.data[n+2]=this.curve(s,t)}this._next(e)},t.prototype.createCurvesFilter=function(){return new v};var m=function(){this.shift=0};n.call(m.prototype),m.prototype.render=function(e){var t=u.convertRGBtoYIQ(e);u.shiftHue(t,this.shift),e=u.convertYIQtoRGB(t,e),this._next(e)},t.prototype.createHueFilter=function(){return new m};var g=function(){this.value=0};n.call(g.prototype),g.prototype.render=function(e){for(var t=0;t<e.data.length;t+=4){var n=e.data[t],r=e.data[t+1],i=e.data[t+2];e.data[t]=Math.min(n+this.value,255),e.data[t+1]=Math.min(r+this.value,255),e.data[t+2]=Math.min(i+this.value,255)}this._next(e)},t.prototype.createBrightnessFilter=function(){return new g};var y=function(){this.multiplier=1};n.call(y.prototype),y.prototype.render=function(e){for(var t=0;t<e.data.length;t+=4){var n=e.data[t],r=e.data[t+1],i=e.data[t+2];e.data[t]=(n-128)*this.multiplier+128,e.data[t+1]=(r-128)*this.multiplier+128,e.data[t+2]=(i-128)*this.multiplier+128}this._next(e)},t.prototype.createContrastFilter=function(){return new y};var b=function(){this.depth=8,this.intensity=18};n.call(b.prototype),b.prototype.render=function(e){for(var t=0;t<e.data.length;t+=4){var n=e.data[t],r=e.data[t+1],i=e.data[t+2],s=(n+r+i)/3;n=r=i=s,n=Math.min(n+this.depth*2,255),r=Math.min(r+this.depth,255),i=Math.max(i-this.intensity,0),e.data[t]=n,e.data[t+1]=r,e.data[t+2]=i}this._next(e)},t.prototype.createSepiaFilter=function(){return new b},e.ImageFilterContext=t})(window);